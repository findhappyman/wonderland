# 🎨 无限画布 - 用户登录系统

## 📋 项目概述

这是一个支持多用户协作的无限画布绘画平台，具有完整的用户登录系统和权限控制。每个用户都有独特的身份标识，只能修改自己创建的绘画内容。

## ✨ 核心功能

### 👤 用户系统
- **用户注册/登录**：简单的用户名登录系统
- **用户名验证**：2-20个字符，不允许重复
- **用户标识**：每个用户有独特的颜色标识
- **在线状态**：实时显示在线用户列表

### 🎨 绘画功能
- **实时协作**：多用户同时绘画，实时同步
- **权限控制**：只能修改自己的绘画内容
- **无限画布**：支持缩放、平移的无限画布
- **流畅绘画**：使用二次贝塞尔曲线的流畅笔触
- **工具选择**：画笔工具和拖动工具

### 🔒 安全特性
- **所有权验证**：服务器验证绘画路径的所有权
- **用户隔离**：每个用户只能修改自己的内容
- **实时同步**：所有操作实时广播给其他用户

## 🚀 快速开始

### 方法一：使用启动脚本（推荐）
```bash
./start-user-system.sh
```

### 方法二：手动启动
```bash
# 启动服务器
cd server
npm install
npm run build
npm start

# 启动客户端（新终端）
cd client
npm install
npm run dev
```

## 🌐 访问地址

- **客户端**: http://localhost:3002
- **服务器**: http://localhost:3001
- **健康检查**: http://localhost:3001/health

## 🎯 使用说明

### 1. 用户登录
1. 打开客户端页面
2. 输入用户名（2-20个字符）
3. 点击"开始绘画"

### 2. 绘画操作
- **画笔模式**：点击"画笔"按钮，拖拽鼠标绘画
- **拖动模式**：点击"拖动"按钮，拖拽移动画布
- **缩放**：使用鼠标滚轮缩放画布
- **调整画笔**：使用滑块调整画笔大小
- **选择颜色**：点击预设颜色或使用颜色选择器

### 3. 多用户协作
- **实时同步**：其他用户的绘画会实时显示
- **用户列表**：右侧面板显示所有在线用户
- **颜色标识**：每个用户有独特的颜色标识
- **权限控制**：只能修改自己的绘画内容

## 🏗️ 技术架构

### 前端技术栈
- **React 18** + TypeScript
- **Socket.io Client** - 实时通信
- **Canvas API** - 绘画渲染
- **Vite** - 构建工具

### 后端技术栈
- **Node.js** + Express
- **Socket.io** - WebSocket服务
- **TypeScript** - 类型安全
- **UUID** - 唯一标识生成

### 数据结构

#### 用户数据
```typescript
interface User {
  id: string;           // 用户ID（Socket ID）
  username: string;     // 用户名
  color: string;        // 用户专属颜色
  isOnline: boolean;    // 在线状态
  joinedAt: Date;       // 加入时间
}
```

#### 绘画路径
```typescript
interface DrawingPath {
  id: string;           // 路径唯一ID
  userId: string;       // 创建者ID
  username: string;     // 创建者用户名
  points: Point[];      // 路径点集合
  color: string;        // 绘画颜色
  size: number;         // 画笔大小
  createdAt: Date;      // 创建时间
}
```

## 🔧 API接口

### Socket.io 事件

#### 客户端发送
- `join_room` - 加入房间
- `drawing_start` - 开始绘画
- `drawing_update` - 更新绘画
- `drawing_end` - 结束绘画
- `cursor_move` - 光标移动

#### 服务器发送
- `room_state` - 房间状态
- `user_joined` - 用户加入
- `user_left` - 用户离开
- `drawing_started` - 绘画开始
- `drawing_updated` - 绘画更新
- `error` - 错误信息

### HTTP接口
- `GET /health` - 健康检查
- `GET /api/rooms/:roomId` - 获取房间信息

## 🛡️ 安全机制

### 用户验证
- 用户名长度验证（2-20字符）
- 用户名唯一性检查
- Socket连接身份验证

### 权限控制
- 绘画路径所有权验证
- 只允许修改自己的内容
- 服务器端权限检查

### 数据保护
- 实时数据同步
- 内存数据存储
- 错误处理和恢复

## 🎨 界面特性

### 登录界面
- 美观的渐变背景
- 响应式设计
- 实时错误提示
- 用户名验证

### 绘画界面
- 直观的工具栏
- 实时用户列表
- 状态信息显示
- 响应式布局

## 🔄 实时同步

### 绘画同步
1. 用户开始绘画 → 服务器创建路径 → 广播给其他用户
2. 用户继续绘画 → 服务器更新路径 → 实时同步
3. 用户结束绘画 → 服务器确认完成 → 保存路径

### 用户状态同步
- 用户加入/离开实时通知
- 在线用户列表实时更新
- 用户颜色标识同步

## 🚀 部署说明

### 开发环境
```bash
# 安装依赖
npm install

# 启动开发服务器
./start-user-system.sh
```

### 生产环境
```bash
# 构建项目
cd server && npm run build
cd ../client && npm run build

# 启动服务
cd server && npm start
# 部署客户端静态文件到Web服务器
```

## 🎯 未来扩展

### 功能扩展
- [ ] 用户注册系统
- [ ] 密码保护
- [ ] 房间管理
- [ ] 绘画历史记录
- [ ] 导出功能
- [ ] 更多绘画工具

### 技术优化
- [ ] 数据库持久化
- [ ] Redis缓存
- [ ] 负载均衡
- [ ] CDN部署
- [ ] 移动端优化

## 📞 支持

如有问题或建议，请联系开发团队。

---

🎨 **享受多人协作绘画的乐趣！** 🌟 